<!DOCTYPE html>
<html>
    <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">     
       <title>Nsis</title>
      <!-- Bootstrap CSS -->
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
-->
     <link rel="stylesheet" href="static/bootstrap-4.3.1-dist/css/bootstrap.min.css"/>
     <script type="text/javascript" src="static/jquery/jquery-3.4.1.min.js"></script>
     <script type="text/javascript" src="static/popper/popper.min.js"></script>
     <script type="text/javascript" src="static/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
     <link rel="stylesheet" type="text/css" href="static/css/style.css"/> 
     <!-- Full local -->
     <link rel="stylesheet" type="text/css" href="static/DataTables/datatables.min.css"/>
     <script type="text/javascript" src="static/DataTables/datatables.min.js"></script>

    </head>

<body>
<!--
<div id="overlay"></div>                   
-->

<div class="container-fluid">
  <div class="row">
    <div class="col">
            <!--Sidebar content -->
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>C00</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R00</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R01</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R02</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R03</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R04</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R05</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R06</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R07</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R08</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R09</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R10</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R11</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R12</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R13</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R14</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R15</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R16</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R17</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R18</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R19</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R21</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R22</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R23</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R24</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R25</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R26</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R27</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R28</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R29</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R30</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R31</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R32</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R33</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R34</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R35</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R36</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R37</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R38</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R39</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R40</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R41</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R42</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R43</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R44</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R45</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R46</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R48</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R49</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R50</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R51</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R52</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R53</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R54</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R55</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R56</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R57</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R58</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R59</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R60</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R61</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R62</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R63</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R64</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R65</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R67</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R68</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R69</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R70</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R71</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R72</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R73</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R74</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R75</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R76</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R77</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R78</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R79</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R83</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R86</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R87</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R89</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R95</botton>
            <button type='button' class='ufpsbtn btn btn-outline-info btn-sm' aria-pressed='true'>R96</botton>

    </div> <!-- col-->
  </div> <!-- row -->
  <div class="row">
    <div class="col">
      <!--Body content-->
        <h2 class="text-primary" >Мониторинг версий ПО МАС ОПС УФПС Липецкой обл.</h2>
        <!--        <p><a href="/demo">Демо</a></p> -->
        <p> <button type="button" class="btn btn-light" data-toggle="modal" data-target="#insertModal"
                data-whatever="@Какието данные">&#9997;ДОБАВИТЬ НОВУЮ ЗАПИСЬ В ЖУРНАЛ</button> </p>

       <table id="myTable" class="cell-border compact stripe  buttons"> <!-- responsive -->
            <thead><th>Id</th><th>Время обновления</th><th>Имя</th><th>Russian Post EAS nsi</th><th>Russian Post EAS sdo</th>
                    <th>Russian Post EAS Configuration</th>
                    <th>Russian Post EAS user</th>
                    <th>Russian Post EAS trans</th>
                    <th>Примечание</th>
                    <th></th>
            </thead>
<!--            
        <tbody>
         {{range . }}
            <tr data-tr-id={{.ID}}>
                <td class="uid"> {{.ID}}</td>
                <td>{{.UpdatedAt}}</td>
                <td class="uname"> {{.Name}}</td>
                <td class="ustatus"> {{.Status}}</td>
                <td class="ustatussdo"> {{.Statussdo}}</td>
                <td class="ustatusupd"> {{.Statusupd}}</td>
                <td class="ustatusauth"> {{.Statusauth}}</td>
                <td class="ustatustrans"> {{.Statustrans}}</td>
                <td class="unote"> {{.Note}}</td>
                <td><a href="#" class="edit_modal" data-toggle="modal" data-target="#editModal">&#9998;</a></td>
            </tr>
            {{end}}
            
        </tbody>
-->        
        <tfoot class="text-primary">
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        </tfoot>
    </table>

    </div> <!-- col -->
  </div> <!-- row -->

  <!-- </div> -->

<!-- CREATE NEW -->
<div class="modal fade" id="insertModal" tabindex="-1" role="dialog" aria-labelledby="insertModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="insertModalLabel">Добавление имени ПК для мониторинга</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="ajaxCreateForm" method="POST" action='mcreate' >
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Имя ПК для мониторинга:</label>
            <input type="text" class="form-control" id="recipient-name" name="name" value = "R48-" >
            <label for="recipient-status" class="col-form-label">Статус RussianPostEASnsi:</label>
            <input type="text" class="form-control" id="recipient-status" name="status" value = "New" >
            <label for="recipient-statussdo" class="col-form-label">Статус RussianPostEASsdo:</label>
            <input type="text" class="form-control" id="recipient-statussdo" name="statussdo" value = "New" >
            <label for="recipient-statusudp" class="col-form-label">Статус RussianPostEASConfiguration:</label>
            <input type="text" class="form-control" id="recipient-statusupd" name="statusupd" value = "New" >
            <label for="recipient-statusauth" class="col-form-label">Статус RussianPostEASuser:</label>
            <input type="text" class="form-control" id="recipient-statusauth" name="statusauth" value = "New" >
            <label for="recipient-statustrans" class="col-form-label">Статус RussianPostEAStrans:</label>
            <input type="text" class="form-control" id="recipient-statustrans" name="statustrans" value = "New" >
            <label for="recipient-note" class="col-form-label">Примечание:</label>
            <input type="text" class="form-control" id="recipient-note" name="note" value = "Note" >
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Выйти</button>
        <button type="button" class="btn btn-primary" id="SaveInsertModal" >Записать</button>
      </div>
    </div>
  </div>
</div>


<!-- EDIT RECORDS -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Редактирование данных</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="ajaxEditForm" method="POST" action='medit' >
          <div class="form-group">
            <label for="edit-id" class="col-form-label">ID</label>
            <input type="text" class="form-control" id="edit-id" name="id" disabled >
            <label for="edit-name" class="col-form-label">Имя ПК:</label>
            <input type="text" class="form-control" id="edit-name" name="name" disabled >
            <label for="edit-status" class="col-form-label">Статус RussianPostEASnsi:</label>
            <input type="text" class="form-control" id="edit-status" name="status" >
            <label for="edit-statussdo" class="col-form-label">Статус RussianPostEASsdo:</label>
            <input type="text" class="form-control" id="edit-statussdo" name="statussdo" >
            <label for="edit-statusupd" class="col-form-label">Статус RussianPostEASConfiguration:</label>
            <input type="text" class="form-control" id="edit-statusupd" name="statusupd" >
            <label for="edit-statusauth" class="col-form-label">Статус RussianPostEASuser:</label>
            <input type="text" class="form-control" id="edit-statusauth" name="statusauth">
            <label for="edit-statustrans" class="col-form-label">Статус RussianPostEAStrans:</label>
            <input type="text" class="form-control" id="edit-statustrans" name="statustrans">
            <label for="edit-note" class="col-form-label">Примечание:</label>
            <input type="text" class="form-control" id="edit-note" name="note">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Выйти</button>
        <button type="button" class="btn btn-primary" id="SaveEditModal" >Записать</button>
      </div>
<!-- ДЛЯ ОТЛАДКИ просмотра ЗАПРОСОВ
  <div class="container">
    <div class="well col-xs-12">
      <div class="control-label col-xs-12">
        <label>Data sent:</label>
      </div>
      <div class="col-xs-12">
        <textarea class="form-control" readonly id="dataSent">here: data sent...</textarea>
        <br>
      </div>
      <div class="control-label col-xs-12">
        <label>Result:</label>
      </div>
      <div class="col-xs-12">
        <textarea class="form-control" readonly id="results">Waiting to send request</textarea>
      </div>
    </div>
  </div>
-->
<!--    </div>
  </div> -->
</div> <!-- container -->

</body>

<script>

$(document).ready(function() {
var $IDRow;
var $myufpsid = getCookie("myufpsid");
//alert(document.cookie); //
console.log('Найден код УФПС='+$myufpsid);
//var $fd=[{myufpsid: $myufpsid}];

function eraseCookie(name) {
    createCookie(name,"",-1);
}                                                                                                    
                                                                                                     
function createCookie(name,value,days) {                                                             
    if (days) {                                                                                      
        var date = new Date();                                                                       
        date.setTime(date.getTime()+(days*24*60*60*1000));                                           
        var expires = "; expires="+date.toGMTString();                                               
    }                                                                                                
    else var expires = "";                                                                           
    document.cookie = name+"="+value+expires+"; path=/";                                             
}                                                                                                    
                                                                                                     
//function readCookie(name) {                                                                          
//    var nameEQ = name + "=";                                                                         
//    var ca = document.cookie.split(';');                                                             
//    for(var i=0;i < ca.length;i++) {                                                                 
//        var c = ca[i];                                                                               
//        while (c.charAt(0)==' ') c = c.substring(1,c.length);                                        
//        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);                      
//    }                                                                                                
//    return null;                                                                                     
//}

//Ловим выбор кода УФПС        
$(".ufpsbtn.btn.btn-outline-info.btn-sm").click(function(event) {                                    
    var $myufpsid = $(this).text().trim();                                                           
    eraseCookie("myufpsid");                                                                         
    createCookie("myufpsid",$myufpsid,1);                                                            
//    document.cookie = encodeURIComponent("myufpsid") + '=' + encodeURIComponent($myufpsid);        
//    alert(document.cookie); //                                                                       
    console.log('Выбран УФПС '+$myufpsid);                   
});                                                                                                  
        
// возвращает куки с указанным name,
// или undefined, если ничего не найдено
function getCookie(name) {
  let matches = document.cookie.match(new RegExp(
    "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
  ));
  return matches ? decodeURIComponent(matches[1]) : undefined;
}

 // Setup - add a text input to each footer cell
    $('#myTable tfoot th').each( function () {
        var title = $(this).text();
        $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
    } );

  //var rowData = row.data();
  // DataTable
  var table = $('#myTable').DataTable({
   "processing": true,
   "serverSide": true,
   "language": {
     "url": "static/DataTables/Russian.json"
    },
   "lengthMenu": [[20,25,50, -1], [20,25, 50, "All"]],
    ajax: {
        url: 'mydata?myufpsid='+$myufpsid,
         "type": "POST",

      "dataSrc": function (json) {
      var return_data = new Array();
      for(var i=0;i< json.length; i++){
        return_data.push({
          'ID': json[i].ID,
          'UpdatedAt': json[i].UpdatedAt,
          'Name': json[i].Name,
          'Status': json[i].Status,
          'Statussdo': json[i].Statussdo,
          'Statusupd': json[i].Statusupd,
          'Statusauth': json[i].Statusauth,
          'Statustrans': json[i].Statustrans,
          'Note': json[i].Note,
          'Fedit': '<a href="#" class="edit_modall" data-toggle="modal" data-target="#editModal" data-tr-id ="'+json[i].ID+'">&#9998;</a>'     
        })
      }
      return return_data;
    }
    },
rowId: 'ID',
columns: [
        { title: 'ID', data: 'ID', className: 'id' },
        { title: 'Время обновления', data: 'UpdatedAt', className: 'updatedat' },
        { title: 'Имя', data: 'Name' , className: 'name'},
        { title: 'Post EAS nsi', data: 'Status' , className: 'status'},
        { title: 'Post EAS sdo', data: 'Statussdo', className: 'statussdo'},
        { title: 'Post EAS Configuration', data: 'Statusupd', className: 'statusupd' },
        { title: 'Post EAS user', data: 'Statusauth' , className: 'statusauth'},
        { title: 'Post EAS trans', data: 'Statustrans', className: 'statustrans' },
        { title: 'Примечание', data: 'Note', className: 'note' },
        { title: '#' ,         data: 'Fedit'}

    ],
   initComplete: function () {
            this.api().columns().every( function () {
                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );

                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );

                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );
        },

  // "dom": 'Blfrtip', // только пагинация
  // "dom": '<"top"i>rt<"bottom"flp><"clear">',
    dom: 'B<"clear">lfrtip', // all buttons
  // "dom": '<lf<t>ip>',
   keys: {
        columns: ':not(:last-child)'
    },

    buttons: true,

// Пример замены в тблице поля на ссылку          
//"columnDefs": [ { //Вместо 0 столбца ID отображать ссылку Download
//    "targets": 0,
//    "data": "download_link",
//    "render": function ( data, type, row, meta ) {
//      return '<a href="'+data+'">Download</a>';
//    }
//  } ],

// Переопределими buttons
    buttons: [
        {
                extend: 'csv',
                //Name the CSV
//                filename: 'file_name',
                text: 'Отчет CSV',
                exportOptions: {
                        columns: [0, 1 ,2, 3, 4, 5, 6, 7, 8]
                },
                //Function which customize the CSV (input : csv is the object that you can preprocesss)
                customize: function (csv) {
                        //Split the csv to get the row
                        var split_csv = csv.split("\n");

                        //Remove the row one to personnalize the headers
                        split_csv[0] = '"ID";"Time";"Name";"StatusNSI";"Statussdo";"Statusupd";"Statusauth";"Statustrans";"Note"';

                        //For each row except the first one (header)
                        $.each(split_csv.slice(1), function (index, csv_row) {
                                //Split on quotes and comma to get each cell
                                var csv_cell_array = csv_row.split('","');
                                 //Remove replace the two quotes which are left at the beginning and the end (first and last cell)
                                csv_cell_array[0] = csv_cell_array[0].replace(/"/g, '');
                                csv_cell_array[8] = csv_cell_array[8].replace(/"/g, '');
                                //RANDOM EXAMPLE :insert 123 to 3th cell
                                //csv_cell_array[3] = "123";
                                //Join the table on the quotes and comma; add back the quotes at the beginning and end
                                csv_cell_array_quotes = '"' + csv_cell_array.join('";"') + '"';
                                //Insert the new row into the rows array at the previous index (index +1 because the header was sliced)
                                split_csv[index + 1] = csv_cell_array_quotes;
                        });

                        //Join the rows with line breck and return the final csv (datatables will take the returned csv and process it)
                        csv = split_csv.join("\n");
                        return csv;
                }
        },

        {
                extend: 'excel',
                //Name the EXCEL
                messageTop: 'Мониторинг версий ПО МАС ОПС УФПС Липецкой обл.',
                filename: 'file_name',
                text: 'Отчет EXCEL',
                exportOptions: {
                        columns: [0, 1 ,2, 3, 4, 5, 6, 7, 8]
                }
        },
        {
                extend: 'pdf',
                filename: 'file_name',
                text: 'Отчет PDF',
                messageTop: 'Мониторинг версий ПО МАС ОПС УФПС Липецкой обл.',
                exportOptions: {
                        columns: [0, 1, 2, 3, 4, 5, 6, 7, 8]
                }
        },

]
  }); //DataTable

//$('#myTable').on( 'click', 'tr', function () {
//    $IDRow = table.row( this ).id();
////  alert( 'Clicked row id '+$IDRow);
//});

// Открыть модальную форму добавления записи
$('#insertModal').on('show.bs.modal', function (event) {
//  var button = $(event.relatedTarget) // Button that triggered the modal
//  var recipient = button.data('whatever') // Extract info from data-* attributes
//  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
//  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
//  var modal = $(this)
//  modal.find('.modal-title').text('New message to')
//  modal.find('.modal-body input id="recipient-name"').val(recipient)
});

//Передать на добавление в БД новой записи
$("#SaveInsertModal").click(function(event) {
    event.preventDefault();
    var form = $('#ajaxCreateForm');
    var method = form.attr('method');
    var url = form.attr('action'); //mcreate
    var formdata = form.serialize();
    console.log(formdata);
//    ajaxCallRequest(method, url, formdata);
    if (method =='POST') {
    $.post('mcreate',formdata, processData);
        function processData(data){
                if (data == 'pass') { 
                 console.log('Запись успешно добавлена '+formdata);
                 document.location.href = '/'                                       
                // alert('Запись успешно добавлена !');                                        
                } else {                        
                 alert('Ошибка записи !!! '+ data);                                        
                }                                                
        }// processData  
     } //if method
  });


//$('#myTable').on( 'click', 'tr', function () {
//    $IDRow = table.row( this ).id();
//  alert( 'Clicked row id '+$IDRow);
//});

// Выбрана ссылка "Редактировать" на записи 
$('#myTable').on('click','.edit_modall',function(event) {
 	event.preventDefault();// вырубaем стaндaртнoе пoведение
 	var $editRow =null;
        //получим значения из таблици
    $editRow = $(event.target).closest("tr");
    $uid = $editRow.children('td.id').text().trim();
 	$uname = $editRow.children('td.name').text().trim();
 	$ustatus = $editRow.children('td.status').text().trim();
  	$ustatussdo = $editRow.children('td.statussdo').text().trim(); 
   	$ustatusupd = $editRow.children('td.statusupd').text().trim();     
   	$ustatusauth = $editRow.children('td.statusauth').text().trim(); 
   	$ustatustrans = $editRow.children('td.statustrans').text().trim(); 
   	$unote = $editRow.children('td.note').text().trim(); 
    //console.log('Edit '+$uid+' '+$uname);
    var $editForm = $('#ajaxEditForm');
        $editForm.find('#edit-id').val($uid);
        $editForm.find('#edit-name').val($uname);
        $editForm.find('#edit-status').val($ustatus);
        $editForm.find('#edit-statussdo').val($ustatussdo);
        $editForm.find('#edit-statusupd').val($ustatusupd);
        $editForm.find('#edit-statusauth').val($ustatusauth);
        $editForm.find('#edit-statustrans').val($ustatustrans);
        $editForm.find('#edit-note').val($unote);
}); //.edit_modal

//Передать данные серверу для записи в БД
$("#SaveEditModal").click(function(event) {
    event.preventDefault();
    var form = $('#ajaxEditForm');
    var method = form.attr('method');
    var url = form.attr('action'); //medit
    //var formdata = $(form).serialize();
    //включаем в список на сериализацию в том числе и поля с атрибутом disabled
    var formdata = form.serializeIncludeDisabled();
    console.log(formdata);
    // Для ОТЛАДКИ и ПРОСМОТРА ЗАПРОСОВ
    //ajaxCallRequest(method, url, formdata);
    //
    if (method =='POST') {
    $.post('medit',formdata, processData);
        function processData(data){
                if (data == 'pass') {                            
                 //alert('Запись успешно обновлена !'); 
                 console.log('Запись успешно обновлена '+formdata);
                 document.location.href = '/'                                       
                } else {                        
                 alert('Ошибка записи на сервер ! '+ data);
                }                                                
        }// processData  
     } //if method

  });

//Функция сериализации полей формы в том числе и с атрибутом disabled
$.fn.serializeIncludeDisabled = function () {
    let disabled = this.find(":input:disabled").removeAttr("disabled");
    let serialized = this.serialize();
    disabled.attr("disabled", "disabled");
    return serialized;
};

//Универсальная Функция faking ajax requests
function ajaxCallRequest(f_method, f_url, f_data) {
    $("#dataSent").val(unescape(f_data));
    var f_contentType = 'application/x-www-form-urlencoded; charset=UTF-8';
    $.ajax({
      url: f_url,
      type: f_method,
      contentType: f_contentType,
      dataType: 'json',
      data: f_data,
      success: function(data) {
        var jsonResult = JSON.stringify(data);
        $("#results").val(unescape(jsonResult));
      }
    });
  }

});//document

</script>
</html>
